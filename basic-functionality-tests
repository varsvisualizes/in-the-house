let video;
let poseNet;
let pose;
let wristL;
let wristR;

// flag set

let startFlag = -1;
let scene2Start = -1;

function preload() {
  water = loadImage("watering-can.gif");
}

function setup() {
  createCanvas(600, 400);
  video = createCapture(VIDEO);
  video.hide();
  poseNet = ml5.poseNet(video, modelLoaded);
  poseNet.on('pose', gotPoses);
}


// Let's put all the poses from PoseNet into a list called an array, so we can easily call on them.
function gotPoses(poses) {
  
  // This will list out all the poses we can get. 
  console.log(poses);
  
  // Get the names of all of the keypoints we can access. 
  // 
  //You can see the list here, under "Keypoint Diagram: COCO KeyPoints" - https://github.com/tensorflow/tfjs-models/tree/master/pose-detection
  if(poses.length > 0) {
    pose = poses[0].pose;
  }
}

// Let us know when the poses are loaded up and we're ready to roll
function modelLoaded() {
  console.log("Ready to start posing!");
}


function draw() {
  //image(video, 0, 0);
  
  // begin checking poses
  if(pose) {
    
    // shorthand for wrist positions
    wristL = pose.leftWrist;
    wristR = pose.rightWrist;
    
    let d = dist(wristL.x, wristL.y, wristR.x, wristR.y);
    
    
    intro();

    // monitor wristL position
    textSize(15);
    text("x: " + round(wristL.x,0), 50, 370);
    text("y: " + round(wristL.y,0), 100, 370);
    
    text("startFlag: " + startFlag, 500, 370);
  }

}

function intro() {
  
    background(0, 0, 0);
  
    // position tracker
    ellipse(wristL.x, wristL.y, 50);
  
    fill(255,255,255);
    textSize(32);

    // Introduction text
    text("Welcome to the House", 180, 150);

    textSize(24);
    text("Enter?", 300, 210);
  
    // if the hand touches the "Enter" text, begin the thing
    if(wristL.x > 250 && wristL.x < 450 &&
    wristL.y > 100 && wristL.y < 300) {
    background(0,0,0);
    text("As you wish...", 250, 250);
    startFlag = 1;
  }
  
  if(startFlag == 1) {
    nextScene();
  }
  
}

function nextScene() {
  
  background(255,255,255);
  
  // position tracker
  ellipse(wristL.x, wristL.y, 50);
  
  fill(0,0,0);
  textSize(32);
  text("You are inside.", 250, 250);
  
  textSize(24);
  text("Do it again.", 250, 325);
  
  if(wristL.x > 200 && wristL.x < 400 &&
    wristL.y > 200 && wristL.y < 300) {
    background(0,0,0);
    text("Go.", 250, 250);
    scene2Start = 1;
  }
  
  if(scene2Start == 1) {
    scene2();
  }
  
}

function scene2() {
  background(0, 0, 0);
  
  fill(255, 255,255);
  textSize(32);
  text("We have moved on.", 250, 250);
}
